{% load humanize %}
{% load static %}
{% load i18n %}
{% load comments %}

<div {% if node.is_root_node %}class="parent"{% else %}class="child-of-{{ node.parent.id }}" style="display: none;"{% endif %}>
    <div class="media">
        <a class="float-left" href="#">
            <div class="avatar">
                {% if node.user.avatar %}
                    <img class="media-object" src="{{ node.user.avatar.image }}" />
                {% else %}
                    <img class="media-object" src="{% static 'material-kit/img/placeholder.jpg' %}">
                {% endif %}
            </div>
        </a>
        <div class="media-body">
            <h4 class="media-heading text-left">{{ node.user.first_name }} <small> {{ node.submit_date|naturaltime }}</small></h4>
            <p class="text-left">{{ node.comment }}</p>               
            <div class="media-footer">
                
                {% if not node.is_leaf_node %}
                    <a href="javascript:toggleDiv('child-of-{{ node.id }}');" class="btn btn-link float-right" data-toggle="tooltip" data-placement="bottom" rel="tooltip" data-original-title="{% trans 'Show replies' %}">
                        <i class="fal fa-comments fa-lg comment-icon"></i> {{ node.get_descendant_count }}
                    </a>
                {% endif %}

                {% if user.is_authenticated %}
                
                    <a href="javascript:toggleDiv('{{ node.id }}-reply-form');" class="btn btn-link float-right">
                        <i class="fal fa-reply fa-lg comment-icon"></i> {% trans "Reply" %}
                    </a>

                    <a data-href="{% url 'comments:promote-toggle-api' node.id %}" href="{% url 'comments:promote-toggle' node.id %}" data-promotions="{{ node.promotions.count }}" class="btn btn-link btn-promote float-right {% if node.user_has_promoted %}btn-warning{% endif %}">
                        <i class="fal fa-thumbs-up fa-lg comment-icon"></i> {{ node.promotions.count }}
                    </a>

                    {% get_comment_form for object as form %}
                    <form class="{{ node.id }}-reply-form" action="{% comment_form_target %}" method="POST" style="display: none;">
                        {% csrf_token %}
                        <div class="media-body">
                            <div class="form-group has-warning">
                                <textarea style="padding: 10px;" name="comment" id="comment-{{ node.id }}" class="form-control" placeholder="{% trans 'Write your comment' %}." rows="3" required></textarea>
                            </div>
                            {{ form.content_type }}
                            <span style="display:none">{{ form.honeypot }}</span>
                            {{ form.object_pk }}
                            {{ form.timestamp }}
                            {{ form.security_hash }}
                            {% if node.id %}    
                                <input type="hidden" name="parent" value="{{ node.id }}" />
                            {% endif %}
                            <div class="media-footer">
                                <input class="btn btn-warning btn-wd float-right" type="submit" value="Post" id="id_submit" />
                            </div>
                        </div>
                    </form>
                
                {% endif %}
            </div>
            {% if not node.is_leaf_node %}
                <ul class="children">
                    {{ children }}
                </ul>
            {% endif %}
        </div>
    </div>
</div>