{% extends 'base_quick.html' %}

{% load core_extras %}
{% load i18n %}
{% load static %}
{% load humanize %}

{% block title %}{% trans 'analytics'|capfirst %}{% endblock title %}

{% block content %}
<section class="slice py-5 bg-section-secondary">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="row align-items-center mb-4">
                    <div class="col">
                        <h1 class="h3 mb-0">
                            {% trans 'analytics'|capfirst  %}
                        </h1>
                    </div>
                </div>
                <div class="row mx-n2">

                    <div class="nav nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                      <a class="nav-link active" id="v-pills-home-tab" data-toggle="pill" href="#v-pills-home" role="tab" aria-controls="v-pills-home" aria-selected="true">{% trans 'all'|capfirst %}</a>
                      {% for result_tuple in results %}
                      <a class="nav-link" id="v-pills-{{ result_tuple.1 }}-tab" data-toggle="pill" href="#v-pills-{{ result_tuple.1 }}" role="tab" aria-controls="v-pills-{{ result_tuple.1 }}" aria-selected="false">{{ result_tuple.0|capfirst }}</a>
                      {% endfor %}                      
                    </div>
                    
                    <div class="tab-content w-100" id="v-pills-tabContent">
                        <div class="tab-pane fade show active" id="v-pills-home">
                            {% for result_tuple in results %}
                            <div id="analytics-{{ result_tuple.1 }}" class="analytics-loader" data-url="{% url 'landing:analytics_card' result_tuple.1 %}">
                                <div class="spinner-border text-primary" role="status"><span class="sr-only">...</span></div>
                            </div>
                            {% endfor %}
                        </div>
                        {% for result_tuple in results %}
                        <div class="tab-pane fade" id="v-pills-{{ result_tuple.1 }}">
                            <div id="analytics-{{ result_tuple.1 }}" class="analytics-loader" data-url="{% url 'landing:analytics_card' result_tuple.1 %}">
                                <div class="spinner-border text-primary" role="status"><span class="sr-only">...</span></div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>                
            </div>
        </div>
    </div>
</section>
{% endblock content %}

{% block footer %}{% endblock footer %}

{% block extrascript %}
<script>
document.addEventListener("DOMContentLoaded", function() {
    const loaders = document.querySelectorAll('.analytics-loader');
    
    loaders.forEach(loader => {
        const url = loader.getAttribute('data-url');
        
        fetch(url)
            .then(response => response.json())
            .then(data => {
                loader.innerHTML = data.html;
            })
            .catch(error => {
                console.error('Error loading analytics:', error);
                loader.innerHTML = '<p class="text-danger">Error loading data</p>';
            });
    });
});
</script>
{% endblock extrascript %}